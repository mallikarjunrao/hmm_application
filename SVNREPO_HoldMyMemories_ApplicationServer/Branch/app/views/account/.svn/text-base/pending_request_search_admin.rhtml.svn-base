<br><br>
  <p><font color="white" size="2" face="arial"><a href="/account/cancelled_list_admin">Click here to get the list of cancelled users</a></font></p>
<script type="text/javascript">
	function chg(val)
	{
		
		if ( val=='USA') {
			document.getElementById('pcode').style.display = 'block';
			document.getElementById('cty').style.display = 'none';
		}else{
			document.getElementById('pcode').style.display = 'none';
			document.getElementById('cty').style.display = 'block';
		}
		
	}
</script>
<style>

</style>

<form name="frm" action="/account/pending_request_search_admin" method="post" >

	
	<table cellpadding="4" cellspacing="4" border="1" bordercolor="#e5b467" align="center" align="center">
	<tr>
		<td colspan="4" align="center" height="48">
			<font size="4">Search User's </font>
		</td>
	</tr>
	<tr>
		
	
	
		<td>
			Firstname
		</td>
		<td>

			<input type="text" name="firstname" id="firstname" value="<%=@fname%>" size="20" class="textbox-signup" />
			
		</td>
			<td>
			Lastname
		</td>
		<td>
			<input type="text" name="lastname" id="lastname" value="<%=@lname%>" size="20" class="textbox-signup" />
		</td>
	</tr>
	<tr>
			<td width="90">
			Username
		</td>
		<td>
				<input type="text" name="username" id="username" value="<%=@uname%>" size="20" class="textbox-signup" />
		</td>
		<td width="90">
			Account Type
		</td>
		<td>
			<select name="account_type" id="account_type" class => "combobox1">
			<option value="Select" selected='selected'>Select</option>
			<option value="free_user" >free_user</option>
			<option value="familyws_user" >Family Website User</option>
			<option value="platinum_user" >premium_user</option>
		</td>
	
	</tr>
	
	<tr>
		<td>
			Country
		</td>
		<td>
			<select name="v_country" onchange='return chg(this.value)' class => "combobox1">
				<%if @country=="USA" 
					@sel1="selected"
				   else
					@sel2="selected"
				   end	
		%>
		
				
					<option value="USA" <%=@sel1%>>USA</option>
				<option value="Others" <%=@sel2%> >Others</option>
		</td>
	
		<td>
			<label for="hmm_user_zip">
			<div id='pcode' style='display:block;'>Postal Code </div>
			<div id='cty' style='display:none;'>City/Province</div></lable></th>
		</td>
		<td>
			<input type="text" name="zip" id="zip" value="<%=@zip%>" size="20" class="textbox-signup" />
			
		</td>
	</tr>
	<tr>
		<td>
			Sort by
		</td>
		<td>
			<%if @sort_key=="v_user_name" 
					@sel11="selected='selected'"
				   else
				  if @sort_key=="v_fname" 
					@sel12="selected='selected'"
				   else
				  if @sort_key=="e_sex" 
					@sel13="selected='selected'"
				   else
				  if @sort_key=="v_e_mail" 
					@sel14="selected='selected'"
				   else
				  if @sort_key=="e_user_status" 
					@sel15="selected='selected'"
				  
				   end	
end	
end	
end	
end	
puts @sel12
		%>
			<select name="sort_key" onchange='return chg(this.value)' class => "combobox1">
				
		
				
					
				<option value="v_user_name" <%=@sel11%>>User Name</option>
				<option value="v_fname" <%=@sel12%>>First Name</option>
				<option value="e_sex" <%=@sel13%>>Sex</option>
				<option value="v_e_mail" <%=@sel14%>>Email Address</option>
				<option value="e_user_status" <%=@sel15%>>Status</option>
                                
				</td>
	
		<td>
			Sort Order
		</td>
		<td>
			<select name="sort_order" onchange='return chg(this.value)' class => "combobox1">
				<%if @order==="asc" 
					@sel21="selected"
				   else
					@sel22="selected"
				   end	
		%>
		
				
					
				<option value="asc" <%=@sel21%>>ascending</option>
				<option value="desc" <%=@sel22%>>Descending</option>
				
				</td>
	</tr>
	
	<tr>
		<td colspan="4" align="center">
		<input type="image" name="sub" id="search" src="/images/search_over.jpg"  border="0" />
		</td>
	</tr>

</table>

<table border="0">
	
	<tr><td colspan="15"><h3><br>HoldMyMemories Users</h3> </td></tr>
  <tr>

 </td></tr>

  <tr valign='center' align='center'>
  	
  	 
   <th background="/images/body_hor.JPG"><font class='txt'><table> <tr><td>First Name</td></tr></table></font></th>
	<th background="/images/body_hor.JPG"><font class='txt'><table> <tr><td>Last  Name</td></tr></table></font></th>
	<th background="/images/body_hor.JPG"><font class='txt'><table> <tr><td>Sex</td></tr></table></font></th>
	<th background="/images/body_hor.JPG"><font class='txt'><table> <tr><td>User Name</td></tr></table></font></th>
	
	<th background="/images/body_hor.JPG"><font class='txt'><table> <tr><td>Email Address</td></tr></table></font></th>
        <th background="/images/body_hor.JPG"><font class='txt'><table> <tr><td>Account Created Date</td></tr></table></font></th>
        <th background="/images/body_hor.JPG"><font class='txt'><table> <tr><th>Number of days left for the next renewal date</th></tr></table></font></th>
        <th background="/images/body_hor.JPG"><font class='txt'><table> <tr><td>Next Recurring charge Date</td></tr></table></font></th>
	
	<th background="/images/body_hor.JPG"><font class='txt'><table> <tr><td>Status</td></tr></table></font></th>
        <th background="/images/body_hor.JPG"><font class='txt'><table> <tr><td>Reason for Cancellation</td></tr></table></font></th>
        
	<th colspan=2 background="/images/body_hor.JPG"><font class='txt'>Actions</font></th>
	

  </tr>

<% 	odd_or_even = 0 
	i = 0
	for colmn in @hmm_users
	 i = i + 1
	odd_or_even = 1 - odd_or_even
 %>

  <tr class='ListLine<%= odd_or_even %>'>
  	<% hmmdet=HmmUser.find(:all,:conditions=>"id=#{colmn.id}")%>
		<td align="center"><a class='ListLine<%= odd_or_even %>' href="/user_account/authenticate/?id=1&hmm_user[v_user_name]=<%=colmn.v_user_name%>&hmm_user[v_password]=<%=hmmdet[0]['v_password']%>" target="_blank"><%=h colmn.v_fname%></a></td>
	
	<td align="center"><a class='ListLine<%= odd_or_even %>' href="/user_account/authenticate/?id=1&hmm_user[v_user_name]=<%=colmn.v_user_name%>&hmm_user[v_password]=<%=hmmdet[0]['v_password']%>" target="_blank"><%=h colmn.v_lname%></a></td>

   
	
	<td><%=h colmn.e_sex%></td>
	<td><%=h colmn.v_user_name%></td>
	
  	<td><%=h colmn.v_e_mail%></td>
        <td align="center"><%=h colmn.d_created_date.strftime("%m - %d - %Y")%></td>
        <% 
            cur_time=Time.now.strftime("%Y-%m-%d")
        @hmm_user_check =  HmmUser.count(:all, :conditions =>" account_expdate <= '#{cur_time}' and id='#{colmn.id}'")
            if @hmm_user_check > 0
                @hmm_user_max =  HmmUser.find_by_sql(" select ADDDATE(account_expdate,INTERVAL 1 MONTH) as m from hmm_users where id='#{colmn.id}'")
                nextbilingdate = @hmm_user_max[0]['m']
                
           else
                nextbilingdate = "#{colmn.account_expdate}"
               
           end
            if(nextbilingdate == nil || nextbilingdate == "")
              nextbilingdate2 = "Subscription Expired/cancelled"
              renewal_days = "Subscription already expired"
            else
                nextbilingdate1=nextbilingdate.split('-');
                nextbilingdate2="#{nextbilingdate1[1]} - #{nextbilingdate1[2]} - #{nextbilingdate1[0]}"
                @hmm_leftdays=HmmUser.find_by_sql("  SELECT DATEDIFF('#{nextbilingdate1}',CURDATE( ) ) as d  ")
                renewal_days = @hmm_leftdays[0]['d']
            end
            
                
        %>
        <td align="center"><%=  renewal_days%> days</td>
        <td align="center"><%=  nextbilingdate2%></td>
    <td><%=h colmn.e_user_status%></td>
    <td><%=h colmn.cancel_reason%></td>

    <td colspan="2">	
	<a href="/account/cancel_sub/<%=colmn.id%>"  class='ListLine<%= odd_or_even %>' onClick="if(confirm('Are you sure you want to cancel your subscription?')){return true; } else return false;" >Cancel Subscription</a>
	</td>
   </td>
  </tr>
 
<% end %>
<input type="hidden" name="len" id="len" value="<%= i %>"/>

<tr><td>
	<%= link_to 'Previous page', { :page => @hmm_user_pages.current.previous, :username => @uname, :firstname => @fname, :v_country => @country, :zip => @zip, :sort_key => @sort_key, :order => @order } if @hmm_user_pages.current.previous %>
<%= link_to 'Next page', { :page => @hmm_user_pages.current.next , :username => @uname, :firstname => @fname, :v_country => @country, :zip => @zip, :sort_key => @sort_key, :order => @order } if @hmm_user_pages.current.next %> 
</td>
</tr>
</table>




</form>

<table cellpadding="0" cellspacing="0" width="80%" border="1" bordercolor="#e5b467" align="center">
	<tr>
		<td colspan="2" align="center" valign="middle">
			<h3>Customers Report</h3>
		</td>
	</tr>
	<tr>
		<td colspan="2">
			<center>
			No of InActive Users&nbsp;&nbsp; :&nbsp; <%=@hmmuser_blockcnt%> <br></br>
			&nbsp;&nbsp;No of Active Users &nbsp;&nbsp;&nbsp;:&nbsp; <%=@hmmuser_unblockcnt%></center>
			<br></br>
		</td>
	</tr>
	</table>


<br />