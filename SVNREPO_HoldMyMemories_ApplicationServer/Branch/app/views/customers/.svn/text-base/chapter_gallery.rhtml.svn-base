<table width="100%" align="center" valign="top" border="0" cellspacing="0" cellpadding="0">
   <tr>
   	<td valign="middle">
   		<table align="left">
		
		<tr><td valign="middle">
		
	<%= sort_header_tag('d_createddate', :text => "<img  src='/images/date_sort.gif'   border='0'/>") %>

<%= sort_header_tag('v_tagphoto', :text => "<img  src='/images/name_sort.gif'   border='0'/>") %>
</td></tr></table>
	
   	</td>
   <td align="right" valign="top">
   		<% if session[:friend]!='' 
				else
%>
		
		 <%if (@gal_cnt < 1 || @gal_cnt == "")%><a href='/gallery_journal/new/<%=params[:id]%>'><img src="/images/journal-this_btn.jpg" align="absmiddle" valign="right"  border='0'></a></span>
              <%else if @gal_cnt >= 1%>
			  <% for @i in @gallery_journal %>

			  <a href='/gallery_journal/edit/<%=@i.id%>'><img src="/images/journal-this_btn.jpg" align="absmiddle" valign="right"  border='0'></a></span><%end%><%end%><%end%><%end%>
		<a href="/galleries/gallery_fisheye/<%=params[:id]%>"><img src="/images/photoflowicon.jpg" border="0"></a>
   </td>
   <tr>
    <input type="hidden" name="order" value="<%=@params[:order]%>" />



		
      <th width="100%" height=""   align="center" valign="middle"  scope="col" colspan="3">
      	<table width="100%" border="0" cellspacing="0" cellpadding="0" height="30">
      <tr heigh="40">
          <th  align="left" valign="middle" class="" scope="col"><font size=4 face="Arial, Helvetica, sans-serif" color="#eeeeee"> <% @gal = Galleries.find(:all, :conditions => "id=#{params[:id]}")
		 for @i in @gal 
			@gal_name=@i.v_gallery_name
			@gal_type=@i.e_gallery_type		
%>
            <font size="3"> </font>
          </font><%end%><br></th>
        </tr>
       
      </table></th>
     </tr>
    <tr>
      <th height="0" width="100%" bordercolor="#FF0000" colspan="4" align="center" valign="bottom" scope="col">
    	
                        	<div id="table" align="center">
	 	 	  <%= render :partial => "chapgallery_list" %>
		  </div>
	  </th>
    </tr>
	
	<tr><td colspan="3">
	</table>	
		  
<!-- Journal Code for gallery -->

 <%@gallery_journal_count = GalleryJournal.count(:all, :conditions =>" galerry_id=#{params[:id]}")
	if(@gallery_journal_count>0)
%>
<table width="88%" align="center" border="0" class="border" cellspacing="0" cellpadding="0">
        <tr>
          <th width="783" height="" align="left" valign="top" scope="col">
          	<table width="100%" border="0" cellspacing="0" cellpadding="4">
            
			<tr>
              <th height="" align="right" valign="middle" bgcolor="#191919" scope="col" colspan="3"><span class="btmtxt">Journal</span>
			  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			
			
			  <% for @i in @gallery_journal %>

			 <%if session[:friend]==nil || session[:friend]=='' %><a href='/gallery_journal/destroying/<%=@i.id%>'><font size="2">Delete</font></a><%end%>&nbsp;&nbsp;</th>
	        </tr>
			
            <tr>
              <th height="32" align="left" valign="top" scope="col">&nbsp;</th>
              <th align="left" valign="middle" scope="col"><span class="heading-journal"><%= @i.v_title%> &nbsp;&nbsp;
				<% ActiveSupport::CoreExtensions::Time::Conversions::DATE_FORMATS.merge!(
    				:date => "%Y-%m-%d",
    				:presentable_datetime => "%a %b %d, %Y %H:%M",
    				:presentable_date => "%a %b %d, %Y") 
					@created_date=@i.d_created_on%>  

				<%=@created_date.to_s(:presentable_date)%></span></th> 
			  
              <th align="left" valign="top" scope="col">&nbsp;</th>

            </tr>
            <tr>
              <th height="65" align="left" valign="top" scope="col">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
              <th align="left" valign="top" class="text-journal" scope="col"><%= @i.v_journal.gsub("\n", "<br />\n") %></th>
              <th align="left" valign="top" scope="col">&nbsp;</th>
            </tr>
			
<!-- comments to be viewed once approved-->					
<tr>
	<th>&nbsp;</th>
	<th>
		<!-- Gallery comment view -->
		
	<% @tag_cnt = GalleryComment.count(:joins => "as a , gallery_journals as c " , :conditions => "c.galerry_id=#{params[:id]} and c.id=a.gallery_jid and a.e_approval = 'approve'") %>
	<% if @tag_cnt != 0 %>
	
<table width="100%" border="0" class="border" bordercolor="#191919" cellspacing="1" cellpadding="3">
	<input type="hidden" value="<%=params[:id]%>" name="gallery_id" />
    <tr bordercolor="#00000">
     
      <th colspan="2" align="left" valign="middle" bgcolor="#191919" scope="col"><span class="btmtxt"><%if session[:friend]==''%>Approved<%end%> Journal Comments</th>
      </tr>
	

		
	<%  @gal_c = GalleryComment.find_by_sql("select a.*,b.*,c.*, a.id as cid from gallery_comments as a , hmm_users as b, gallery_journals as c where c.galerry_id=#{params[:id]} and c.id=a.gallery_jid and a.uid=b.id and a.e_approval = 'approve' ORDER BY a.id DESC")
		
		 for j in @gal_c %>
	

	<tr bordercolor="#00000">
     
      <th width="155" align="left" valign="top" class="text-journal" scope="col"><span class="style1">Commented By&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>  </th>
      <th width="509" align="left" valign="top" scope="col"><%= j.v_fname%></th>
    </tr>
	
	<tr bordercolor="#00000">
     
      <th align="left" valign="top" class="text-journal" scope="col"><span class="style1">Comment&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>  </th>
      <th align="left" valign="top" scope="col"><%= j.v_comment.gsub("\n", "<br />\n") %></th>
    </tr>
	
    <tr bordercolor="#00000">
     
      <th colspan="2" align="right" valign="middle" height="10" bgcolor="#191919" class="text-journal" scope="col">
       		<% if j.e_approval=="pending" %>
			 <a href='/gallery_comment/add_comment/<%= j.cid %>'>Approve</a>&nbsp;&nbsp;&nbsp;
			<a href='/gallery_comment/reject_comment/<%= j.cid %>'>Reject</a> 
			<%else%>
			
		<% if session[:friend]!='' 
				else
%>	<%end%>
			<% end %>	  </th>
	  </tr>
     <%end%>
</table>
  
	</th>
</tr><%end%>			
<!-- comments to be viewed once approved-->				
		<tr>
	<th>&nbsp;</th>
</tr>	
			<font color="#f5dfa6"><%=  flash[:notice_gjc]%></font>
            <font color="#f5dfa6"><%=  flash[:notice_gju]%></font>
            <tr>
                <th height="" align="right" colspan="3" valign="middle" bgcolor="#191919" class="text-journal" scope="col">
      	<% if session[:friend]=='' || session[:friend]==nil%>
		<%else%>
	         	
	<%= link_to_remote("Add Comments", :update =>"me2", 
		:url => {:controller => :gallery_comment, :action => :new, :id=> params[:id] , :id_journal => @i.id }, :layout => false  ) %>

		&nbsp;&nbsp;&nbsp; <%end%>
		<% comnt_gal=GalleryComment.find_by_sql("select count(*) as cnt from gallery_comments  where gallery_id=#{params[:id]} and e_approval='pending' and gallery_jid!='' ")           
  				for cmt_gal in comnt_gal
   				count_gal=cmt_gal['cnt']
  				end
		%> 
        <%if session[:friend]=='' %>
	<%= link_to_remote("View Comments "+" ("+count_gal+")", :update =>"me2", 
		:url => {:controller => :gallery_comment, :action => :comnt_list, :gal_id=> params[:id] , :id => @i.id }, :layout => false  ) %>
		&nbsp;&nbsp;&nbsp;
<%end%>
            
            </tr>
			
			<tr>
				<td colspan="2">
					<font color="#f5dfa6"><%=  flash[:notice_gcc]%></font>
					<font color="#f5dfa6"><%=  flash[:notice_gca]%></font>
					<font color="#f5dfa6"><%=  flash[:notice_gcr]%></font>
					<font color="#f5dfa6"><%=  flash[:notice_gcd]%></font>
				</td>
			</tr>
			
			<tr>
              <th align="center" colspan="3" valign="top" class="text-journal" scope="col"><div id="me2"></div><br></th>
            </tr>
			<%end%>
			
           </table></th>
         
		  
        </tr>
	
      </table>

	</td></tr>
  </table>	
  <%end%>

  
<% session['redirect'] =  '0' %>

<p align='center'>
<form name="frm">
<img src="/images/circle_load.gif" align="absmiddle" border="0" id="spinner" style="display: none;" />
			  
<%= observe_field 'query',  :frequency => 2,
         :update => 'table',
         :before => "Element.show('spinner')",
         :success => "Element.hide('spinner')",
         :url => {:action => 'list'},
         :with => 'query' %>
</form>	
</p>
  
  
  
  
  
  
  
  				  
