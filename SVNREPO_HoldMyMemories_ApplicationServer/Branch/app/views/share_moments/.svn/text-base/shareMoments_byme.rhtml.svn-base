<script type="text/javascript">
    function validate() {
      /*
      Following filter taken from
      
      http://www.quirksmode.org/js/mailcheck.html
      
      */
      var filter = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
      var addresses = document.getElementById( "idEmail" ).value.split( "," );
      var ok = true;
      for ( var i=0; i<addresses.length; ++i ) {
        if ( !addresses[i].match(filter) ) {
          ok = false;
          
		  break;
        }
      }
      if ( ok ) {
       // alert( "Input is valid!" );
		return true;
      } else {
        alert( "Input is not valid!" );
		return false;
      }
    }
  </script>
<%session[:sharepath]='fnf'%>
<% session[:friend]=''%>
<div id="share_byme">
  <table border="0">
    <tr>
      <th  align="left" valign="top" scope="col"></th>
      <th height="22" align="left" valign="top" scope="col">
      <table  border="0" cellspacing="0" cellpadding="0">
        <tr>
          <th  height="22" align="left" valign="top" scope="col">
           <a href="/customers/edit_profile/<%=logged_in_hmm_user.id%>" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('Image22','','/images/manage-profile_over.jpg',1)"> <img src="/images/manage-profile_def.jpg" name="Image22" width="140" height="22" border="0" id="Image22" /></a> </th>
        
       
          <th width="206" align="left" valign="top" scope="col"> <img src="/images/manage-fndsandfmly_over.jpg" name="Image24" width="206" height="22" border="0" id="Image24" /></a> </th>
          <th width="164" align="left" valign="top" scope="col"> <a href="/chapter_comment/allcmt_list/" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('Image25','','/images/manage-comments_over.jpg',1)"> <img src="/images/manage-comments_def.jpg" name="Image25" width="164" height="22" border="0" id="Image25" /></a> </th>
      
        
        <th width="164" align="left" valign="top" scope="col"> <a href="/share_moments/manageShare/" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('Image26','','/images/manage-share_over.jpg',1)"> <img src="/images/manage-share_def.jpg" name="Image25" width="140" height="22" border="0" id="Image26" /></a> </th>
        
		<th width="206" align="left" valign="top" scope="col">
	  	<a href="/family_members/familypage_step1/<%=logged_in_hmm_user.id%>" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('Image26','','/images/mang_family_web_over.jpg',1)">
	  	<img src="/images/mang_family_web_def.jpg" name="Image25" width="206" height="22" border="0" id="Image26" /></a>	  
		</th>
		</tr>
      </table>
      </th>
      <th width="390" align="left" valign="top" scope="col"></th>
    </tr>
  </table>
     <%=@share_cnt%> <% @sharemoment_cnt%> <% @totalshare_cnt%> <% @numberofpages%>
         
		 
		  <% 
		params[:id]=logged_in_hmm_user.id
     	my_details=HmmUsers.find(params[:id])

			shared=Share.find_by_sql("
						(
							SELECT distinct(b.usercontent_id),b.id AS id, b.presenter_id AS presenter, b.email AS email, b.expiry_date AS expire, b.created_date as createdate, b.message as message, b.ctype as typeshare, b.usercontent_id as xmlname
							FROM share_moments AS b
							WHERE b.presenter_id = '#{logged_in_hmm_user.id}' 
							AND DATE_FORMAT( b.expiry_date, '%Y-%m-%d' ) >= curdate( ) group by b.usercontent_id
						)
						union 
						(
							SELECT distinct(a.id), a.id AS id, a.presenter_id AS presenter, a.email_list AS email, a.expiry_date AS expire, a.created_date as createdate, a.message as message, a.ctype as typeshare, a.xml_name as xmlname
							FROM shares AS a
							WHERE a.presenter_id = '#{logged_in_hmm_user.id}'
							AND DATE_FORMAT( a.expiry_date, '%Y-%m-%d' ) >= curdate( )
						)
							order by createdate desc limit #{@x},#{@y}")
     	
		%>
         
  
  <font color="f5dfa6">
  	<%= flash[:notice_accept] %></font> <font color="f5dfa6"><%= flash[:notice_reg]%></font>
 <% cnt_rows= @totalshare_cnt + 2 %>
  <table border="0" width="100%">
 <tr>
   <td width="8%">&nbsp;</td>
   <td width="9%">&nbsp;</td>
   <td width="12%">&nbsp;</td>
   <td width="11%">&nbsp;</td>
   <td width="11%">&nbsp;</td>
   <td width="11%">wwdwe</td></tr>
    <tr>
    
    <td align="left" valign="top" colspan="10"><div id="effect_area">
        <h3>Shared Moments By Me</h3>
		
        <table width="100%"  cellspacing="4"  cellpadding="4">
        <tr>
          <td  >
       <h4><font color="white"> List of shares </font></h4></td>
          <td ></td><td valign="top"  colspan="3" rowspan="<%=cnt_rows%>"  ><div id="me"></div></td>
        </tr>
		<% j=0 %>
         <%for sha in shared
			
                                        params[:id]=sha.presenter
					filename=sha.xmlname
					friend_details=HmmUsers.find(params[:id]) 
					friend_name=friend_details.v_fname
					friend_image=friend_details.v_myimage
					shareid=sha.id
					sharemessage=sha.message
					typetable = sha.typeshare 
		if(sha.typeshare!="momentShare")
		  sharedmoments = SharedMomentId.find(:all, :conditions => "share_id=#{sha.id}")
          
                  for sharedmoment in sharedmoments
                   moment=UserContent.find(:all,:conditions => "id= #{sharedmoment.moment_id}")
                   if(moment[0]['e_filetype'] == "image")
                       share_image="#{moment[0]['img_url']}/user_content/photos/big_thumb/#{moment[0]['v_filename']}"
                       
                   end
                   if(moment[0]['e_filetype'] == "video" || moment[0]['e_filetype'] == "swf")
                       share_image="#{moment[0]['img_url']}/user_content/videos/thumbnails/#{moment[0]['v_filename']}.jpg"
                   end
                   if(moment[0]['e_filetype'] == "audio")
                       share_image = "#{moment[0]['img_url']}/user_content/audios/speaker.jpg"
                   end
                   hmmtype=moment[0]['e_filetype']
                  end
		else
		  usercontent=UserContent.find(sha.xmlname)
		  if(usercontent.e_filetype=="image")
			share_image="#{usercontent.img_url}/user_content/photos/journal_thumb/#{usercontent.v_filename}"  
		  else
		  	if(usercontent.e_filetype=="audio")
				share_image="/user_content/audio/speaker.png"
		  	else
				share_image="#{usercontent.img_url}/user_content/videos/thumbnails/#{usercontent.v_filename}" + ".jpg"	  	
			end			
		  end	
		end
		
%>
          
		  <tr>
          <td>
          	<table class="border">
		         <tr><td height="3"></td></tr>
				  <tr>
		          	<td align="center" valign="bottom">
		          		<img src="<%=share_image%>" width="55"  />				  	</td>
				  </tr>
				  <tr>
				  	<%sha_msg=sha.message.slice(0,10)%>
		          	<td align="center" valign="top">
		          		<%= link_to_remote("#{sha_msg}" , :update =>'me', :url => {:action => :share_info, :share_selected_id => sha.id, :ctype => sha.typeshare } ) %>				  	</td>
				  </tr>
				   <tr><td height="3"></td></tr>
		  	</table>		  </td>
		  </tr>	
		  <tr><td height="10"></td></tr>
          <%if j==0 %>
		  <%else%>
		  <td colspan="5" ></td>
		  <%end%>
         </tr>
         
           <%end%>
       </table>
      </div></td><td width="29%" valign="top" ><table align="center"   border="0" cellspacing="0" cellpadding="0">
        <font color="f5dfa6"></font>
        <tr bgcolor="#191919" height="20">
          <th colspan="2" align="left" valign="middle" scope="col"><font size="2"><font face="Arial, Helvetica, sans-serif">Manage Groups</font></font></th>
        </tr>
        <tr>
          <th  align="left" valign="top" class="text-journal" scope="col"> <table  align="center" border="0" >
              <% for group in @fnf_groups %>
              <tr>
                <td><% friends = FamilyFriend.count(:all, :conditions => "fnf_category=#{group.id} and status='accepted'")%>
                  <a href="/customers/fnf_show/<%=group.id%>"><%=group.fnf_category%>(<%=friends%>)</a></td>
                <%if group.fnf_category=='Friends' || group.fnf_category=='Family' %>
                <td colspan="2"> Default Group
                <td><%else%>
                <td><%= link_to_remote("Edit",
				:update => 'effect_area', :url => {:controller => :fnf_group, :action => :edit, :id => group.id }) %> </td>
                <td><a href="/fnf_group/destroying/<%=group.id%>">Delete</a> </td>
              </tr>
              <%end%>
              <%end%>
            </table></th>
          <th  align="left" valign="top" scope="col"></th>
        </tr>
        <tr>
          <th align="left" valign="top" class="text-journal" scope="col">&nbsp;</th>
          <th align="left" valign="top" scope="col"></th>
        </tr>
        <tr>
          <th align="left" valign="top" class="text-journal" scope="col">&nbsp;</th>
          <th align="left" valign="top" scope="col"></th>
        </tr>
        <tr class="border"  align="center" height="20">
          <th colspan="2"  align="left" valign="top" class="text-journal" scope="col"><font face='Arial, Helvetica, sans-serif'><u> <a href="/customers/list_share/<%=group.id%>">Friends Shared Moments</a></u></font> </th>
        </tr>
        <tr>
          <th colspan="2" align="left" valign="top" class="text-journal" scope="col">&nbsp;</th>
        </tr>
        <tr class="border"  align="center" height="20">
          <th colspan="2"  align="left" valign="top" class="text-journal" scope="col"><font face='Arial, Helvetica, sans-serif'><u> <a href="/share_moments/shareMoments_byme/<%=group.id%>">Shared Moments by Me</a></u></font> </th>
        </tr>
        <tr>

          <th colspan="2" align="left" valign="top" class="text-journal" scope="col">&nbsp;</th>
        </tr>
        <tr class="border"  align="center" height="20">
          <th colspan="2" align="left" valign="top" class="text-journal" scope="col"> <font face='Arial, Helvetica, sans-serif'><u><a href="/customers/list_imports/<%=group.id%>">Imported Moments</a></u></font> </th>
        <tr>
          <th colspan="2" align="left" valign="top" class="text-journal" scope="col">&nbsp;</th>
        </tr>
        
        
        <tr class="border"  align="center" height="30">
          <th colspan="2" align="left" valign="top" class="text-journal" scope="col"> <font face='Arial, Helvetica, sans-serif'><u><a href="/customers/list_export/<%=group.id%>">Exported Moments</a></u></font> </th>
        </tr>
        <tr>
          <th colspan="2" align="left" valign="top" class="text-journal" scope="col">&nbsp;</th>
        </tr>
        <tr class="border"  align="center" height="20">
          <th colspan="2" align="left" valign="top" class="text-journal" scope="col"> <font face='Arial, Helvetica, sans-serif'><u><a href="/customers/shareJournal_list/<%=group.id%>">Shared Journals</a></u></font> </th>
        <tr>
        <tr>
          <th colspan="2" align="left" valign="top" class="text-journal" scope="col">&nbsp;</th>
        </tr>
        <tr class="border"  align="center" height="">
          <th colspan="2" align="left" valign="bottom" class="text-journal" scope="col"> <font face='Arial, Helvetica, sans-serif'><b>Invite friends</b></font>
            <form method="post" action="/invite_friends/create" onSubmit="return validate();">
              <p> Please enter one or more email addresses separated by commas. </p>
              <input type="text" name="email" id="idEmail"  size=""/>
              <input type="submit" value="add friends" />
            </form></th>
        </tr>
        <font color="fdf1ca"></font>
    </table></td></tr>
    <tr>
      <td ></td>
      <td ></td>
      <td ></td>
      <td ></td>
      <td ></td>
      <td ></td>
    <td width="3%"  valign="top"></td>
    </tr>
  </table>
  <br>
</div>
