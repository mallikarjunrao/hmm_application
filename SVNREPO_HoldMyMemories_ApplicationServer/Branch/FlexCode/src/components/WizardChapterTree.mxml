<?xml version="1.0" encoding="utf-8"?>
<mx:VBox xmlns:mx="http://www.adobe.com/2006/mxml" width="100%" height="100%" implements="components.IWizardComponent" backgroundColor="0">
	<mx:Label text="Please select a gallery" fontSize="13" fontFamily="arial" fontWeight="bold"/>
	<mx:Tree  id="tree" width="100%" height="100%" labelFunction="treeLabel" itemRenderer="renderers.GallerySelectionRenderer" 
			backgroundAlpha="0.8" color="#ffffff" backgroundColor="0x0" fontFamily="Arial" creationComplete="handleCreationComplete()"/>
	<mx:Script>
		<![CDATA[
			import mx.controls.Alert;
			import vo.GalleryVO;
			import vo.SubChapterVO;
			import vo.ChapterVO;
			import mx.collections.ArrayCollection;
			import model.HmmChaptersModel;
			import mx.collections.XMLListCollection;
			public function getComponentData() : Object
			{
				//if(tree.selectedItem)
					return tree.selectedItem;
				/* else
				{
					Alert.show("Please select a Gallery!!!");
					return null;
				} */
						
				
			}
			
			public function validateComponentData() : Boolean
			{
				if(tree.selectedItem)
				 return true;
				else
				{
					Alert.show("Please select a Gallery!!!");
					return false;
				}
			}
			
			public function finalizeComponent() : void
			{
				
				
			}
			
			private function handleCreationComplete() : void
			{
				treeData = HmmChaptersModel.getInstance().folderList;
				
			}
			
			private function treeLabel(item:Object):String {
                var node:XML = XML(item);
               
                    return item.@label;
            }
			private var dataSet : XML =  <list></list>;;		
			private var type : String;
			public function set treeData (value : ArrayCollection) : void
			{
				
                //var rootList:XMLList =dataSet.children();
                /* if( dept.length() > 0 ) {
                    dept[0].appendChild(newNode);
                    empName.text = ""; */
				for(var i : int = 0; i < value.length; i++)
				{
					
						var chapter : ChapterVO = value[i] as ChapterVO;
						var subchapters : Array = chapter.subchapters;
						var newNode:XML = <node></node>;
                		newNode.@label = chapter.name;
						newNode.@icon = chapter.icon;
						newNode.@id = chapter.id;
						newNode.@type = "tags";
						newNode.@select = false;
						for(var j : int = 0; j < subchapters.length; j++)
						{
							var subchapter : SubChapterVO = subchapters[j] as SubChapterVO;
							var subNode : XML = <node></node>;
							subNode.@label = subchapter.name;
							subNode.@icon = subchapter.icon;
							subNode.@id = subchapter.id;
							subNode.@type = "subchapter";
							subNode.@select = false;
							var galleries : Array = subchapter.gallery;
							for(var k : int = 0; k < galleries.length; k++)
							{
								var gal : GalleryVO = galleries[k] as GalleryVO;
								if(gal.type == "video")
								{
									var galNode : XML = <node></node>;
									galNode.@label = gal.name;
									galNode.@icon = gal.icon;
									galNode.@id = gal.id;
									galNode.@type = "gallery";
									galNode.@hmmtype = gal.type;
									galNode.@select = false;
									subNode.appendChild(galNode);	
								}
								
							}
							newNode.appendChild(subNode);
						}
						dataSet.appendChild(newNode);
						type = "tags";	
				}
				//randomWalk.dataProvider = dataSet;
				tree.dataProvider = new XMLListCollection(dataSet.node);
				trace(dataSet);
			}
			
		]]>
	</mx:Script>			
</mx:VBox>
