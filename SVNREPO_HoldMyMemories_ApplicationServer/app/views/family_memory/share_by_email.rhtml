<link href="/stylesheets/main.css" media="screen" rel="Stylesheet" type="text/css" />
<link href="/stylesheets/hmm.css" media="screen" rel="Stylesheet" type="text/css" />
<link href="/stylesheets/mystyle_black_left.css" rel="stylesheet" type="text/css" />
<%= stylesheet_link_tag 'hmmout' %>

<style type="text/css">

  .loginBig{
    background:transparent;
    background:url(/images/family_memory/input-big.png);
    border:none;
    height:35px;
    width:140px;
    font-size:12px;
    color:#87a3b5;
  }
  .loginBig:hover{
    background:url(/images/family_memory/input-big-ovr.png);
  }
</style>
<script language="javascript">
  function validate() {
    alert("2dffewfwe");
    return false;
  }
  /*
      Following filter taken from

      http://www.quirksmode.org/js/mailcheck.html

   */
  /*  var filter = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
      var addresses = document.getElementById( "reciepent_email" ).value.split( "," );
      var ok = true;
      for ( var i=0; i<addresses.length; ++i ) {
        if ( !addresses[i].match(filter) ) {
          ok = false;

                  break;
        }
      }
      if ( ok ) {
       // alert( "Input is valid!" );
                return true;
      } else {
        alert( "Input is not valid!" );
                return false;
      }
    }
   */

  function verify()
  {

    if (document.getElementById('valid_pass').value == 'false')
    {
      alert('invalid password!!');
      document.getElementById('employe_username').focus();
      return false;
    }

  }




  function trim(stringToTrim) {
    return stringToTrim.replace(/^\s+|\s+$/g,"");
  }

  function format_emails()
  {
    var emails = document.getElementById('reciepent_email').value;
    var email = emails.split(',');
    for(var i=0;i<email.length;i++){
      email[i]=trim(email[i]);
    }
    emails=email.join(',');
    var email = emails.split(';');
    for(var i=0;i<email.length;i++){
      email[i]=trim(email[i]);
    }
    emails=email.join(',');
    document.getElementById('reciepent_email').value=emails;
  }

</script>
<%  @studio_header = HmmStudio.find(@family_website_owner.studio_id)
if @studio_header.studio_groupid==pp_studio_group%>

  <%= render :partial => "/family_memory/partials/share_by_email_pp", :locals => {:userid=> @userid, :results1 => @results1, :family_website_owner => @family_website_owner, :password_protected => @password_protected} %>

<% else %>
  <table width="100%" border="0" cellspacing="0" cellpadding="0">
    <tr>
      <td width="23%">&nbsp;</td>
      <td width="77%"><img src="/images/family_memory/hmm-logo.png" /></td>

    </tr>
  </table>
  <table width="100%" border="0" cellspacing="0" cellpadding="0">
    <tr>
      <td height="50" align="center" valign="top"></td>
    </tr>
    <tr>
      <td height="10" align="center" class="msgHead" valign="top"><%=  flash[:message] %></td>
    </tr>
    <form action="/family_memory/share_by_email/" method="post" onsubmit=" if(document.getElementById('sender_name').value==''){ alert('Please enter sender name'); document.getElementById('sender_name').focus();return false;} if(document.getElementById('sender_email').value==''){ alert('Please enter sender email'); document.getElementById('sender_email').focus();return false;} var addresses = document.getElementById( 'reciepent_email' ).value.split(/,|;/ ); var ok=true; var filter = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/; if(document.getElementById('reciepent_email').value=='' && document.getElementById('amail').value==''){ alert('Please enter an email address to share'); return false;}  if(document.getElementById('pass_req').style.display=='block') { if (document.getElementById('pass').value == ''){alert('please enter family website password.');document.getElementById('pass').focus();return false; } }" >
      <tr>
        <td>
          <table width="700" align="center" border="0" cellspacing="0" cellpadding="0" class="content-trans-bg" style="padding: 17px 0px 15px 38px;">
            <input type="hidden" value="<%=params[:id]%>" name="id" />
            <% if params[:pa]%>
              <input type="hidden" value="<%=params[:link]%>" name="link" />
            <%else%>
              <input type="hidden" value="<%=params[:link]%>" name="link" />
            <%end%>
            <input type="hidden" value="<%=params[:id]%>" name="share_type" />
            <input type="hidden" value="<%=params[:v]%>" name="v" />
            <input type="hidden" value="<%=params[:moment_id]%>" name="moment_id" />
          <input type="hidden" value="<%= request.url %>" name="redirect_url" />
            <tr>
              <td height="20" align="center" valign="top"  colspan="2" class="msgHead"><font >Lets Share <font color="#fe6809">Memories</font> with our Friends and Family!!</b></font></td>
            </tr>

            <tr>
              <td height="20" align="left" valign="top" colspan="2"><center><font ></center></font></td>
            </tr>

            <tr>
              <td height="20" align="left" valign="top" class="msgHead"><font >Sender Name : &nbsp;&nbsp; <span id="sprytextfield1"> <input type="text" name="sender_name" id="sender_name" value="<%=@userid[0]['v_fname']%>" class="textbox-signup">
                    <span class="textfieldRequiredMsg"><br></br></span></font></td>
              <td height="20" align="left" valign="top" class="msgHead"><font >Sender E-mail : &nbsp;&nbsp;
                  <span id="sprytextfield11"><input type="text" name="sender_email" id="sender_email" value="<%=@userid[0]['v_e_mail']%>" class="textbox-signup">
                    <span class="textfieldRequiredMsg"><br></span><span class="textfieldInvalidFormatMsg"><br></span></span></span></font></td>
            </tr>

            <tr>
              <td height="20" align="left" valign="top" colspan="2"><font color="#ffffff" size="2"> </font></td>
            </tr>

            <tr>
              <td height="20" align="left" valign="top" class="msgHead" colspan="2"><font > Recipient's email : &nbsp;&nbsp;
                  <span id="sprytextfield3"><input type="text"  name="reciepent_email" id="reciepent_email" class="textbox-signup-managepage" onblur="format_emails();" >
                    </font><span class="textfieldRequiredMsg"><br>Value is required.</br></span></span></font></td>
            </tr>
            <tr>
              <td height="20" align="left" valign="top" colspan="2"><font color="#f5dfa6" size="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Separate multiple email addresses with a comma</font></td>
            </tr>
            <tr>
              <td height="20" align="left" valign="top" colspan="2"><font color="#ffffff" size="2"> </font></td>
            </tr>
            <% if session[:hmm_user]%>
              <tr>
                <td height="20" align="left" class="msgHead" valign="top" colspan="2"><table><tr><td valign="top">
                        <font >Select from address book :</font>
                      </td><td>
                        <select multiple="multiple" style="width:300px;height:75px;" name="address_email[]" id="amail">
                          <% for i in @results1 %>

                            <option value="<%=i.v_email%>"><%=i.v_name%> (<%=i.v_email%>)</option>

                          <% end %>
                        </select>
                      </td></tr>
                  </table></td>
              </tr>
              <tr>
                <td height="20" align="left" valign="top" colspan="2"><font color="#f5dfa6" size="2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Hold the Ctrl  key to select multiple email addresses</font></td>
              </tr>
              <tr>
                <td height="20" align="left" valign="top" colspan="2"><font color="#ffffff" size="2"> </font></td>
              </tr>
            <%else%>
              <input type="hidden" name="amail" id="amail">
            <%end%>
            <tr>
              <td height="20" align="left" colspan="2" valign="top">
                <table><tr><td class="msgHead" valign="top">
                      <font > Message to your friend :</font> </td><td>
                      <textarea rows="4" cols="40"   name="reciepent_message" ></textarea>

                    </td></tr>
                  <% if session[:hmm_user] && logged_in_hmm_user.id == @family_website_owner.id %>
                  <% else %>
                    <tr><td colspan="2">
                        <table class="border" align="center">
                          <tr><td align="center"><font color="#ffffff" size="2"> <%= show_simple_captcha(:label => "(Please type the code from the image)", :image_style => 'distorted_black', :distortion => "medium")%></font> </td>
                          </tr>

                        </table>
                    </tr>
                  <% end %>
                </table>
              </td>
            </tr>

            <tr>
              <td height="20" align="left" valign="top" colspan="2"><font color="#ffffff" size="2"> </font></td>
              <td align="left" valign="top" >&nbsp;<%=@password_protected%></td>
            </tr>
            <%@pass_req = HmmUser.count(:all, :conditions => "(family_name='#{params[:id]}' || alt_family_name='#{params[:id]}') and password_required= 'yes'")%>
            <%if @pass_req > 0%>
              <tr>
                <td height="20" align="center" valign="top" colspan="2"><font color="#ffffff" size="2">Note: This family website is password protected, Would you like to share your password ?
                    <br>Yes <input type="radio" name="ask" id="ask" value="yes"  onclick="document.getElementById('pass_req').style.display='block';"> No <input type="radio" name="ask" id="ask" value="no" onclick="document.getElementById('pass_req').style.display='none'; alert('Your friend may not be able to view your website without password!');"> </font></td>
              </tr>
              <tr>
                <td height="20" align="left" valign="top"  colspan="2">
                  <div id="pass_req" style="display:none">
                    <table>
                      <tr>
                        <td class="msgHead">
                          <font > Please enter the family website password to exectue this share &nbsp;
                            <input type="password" name="pass" id="pass" > </font>
                        </td>
                        <%family_name1=params[:id]
                      %>
                      </tr>

                    </table>
                  </div>
                </td>
              </tr>
            <%end%>
            <tr>
              <td height="20" align="right" valign="top"><input type="submit" name="share_bt" class="loginBig" value="Share" />&nbsp;&nbsp;</td>
              <td height="20" align="left" valign="top" >&nbsp;&nbsp;
                <a href="/family_memory/gallery_details/<%= params[:id] %>?moment_id=<%= params[:moment_id] %>"><input type="button" name="share_bt" class="loginBig" value="Cancel" /></a></td>
            </tr>
          </table>
        </td>
      </tr>
    </form>
  </table>
<% end %>
  <script type="text/javascript">

    var sprytextfield1 = new Spry.Widget.ValidationTextField("sprytextfield1", "none", {validateOn:["blur"]});
    var sprytextfield11 = new Spry.Widget.ValidationTextField("sprytextfield11", "email", {validateOn:["blur"]});
    var sprytextfield3 = new Spry.Widget.ValidationTextField("sprytextfield3", "none", {validateOn:["blur"]});
    //var sprytextfield12 = new Spry.Widget.ValidationTextField("sprytextfield12", "email", {validateOn:["blur"]});

  </script>
