<p><font color="#ff0000"><%=flash[:share_familypage]%></font>
  <font color="#ff0000"><%=flash[:share_unsuccefull]%></font>
  <font color="#ff0000"><%=flash[:notice_pjc]%><%=flash[:notice_pjupdate]%></font>
</p>

<link rel="stylesheet" type="text/css" href="/stylesheets/imageScroller.css">
<%= javascript_include_tag 'modalbox/prototype' %>
<script type="text/javascript" src="/javascripts/modalbox/scriptaculous.js?load=effects"></script>
<script type="text/javascript" src="/javascripts/modalbox/modalbox.js"></script>
<%= stylesheet_link_tag 'modalbox/modalbox' %>

<input type="hidden" name="family_name" id="family_name" value="<%=params[:id]%>" />
<% if(params[:modal] == '1')%>
  <script language='javascript'>
    var familyname = document.getElementById('family_name').value;
    Modalbox.show('/my_familywebsite/share?link=/'+familyname+'&error=Invalid Capcha Please try again!!', {title: '<br><font color="#ff0000">Share this Page with your friends!</font>',  width:625})
  </script>

<%end%>


<table width="100%" align="center">
  <tr><td align="right"></td></tr>
  <tr><td>
      <%
      if @norecords==""
        for @i in @user_content


          #code added to display the count of views in gallery
          @view_count = @usercontent.views + 1
          sql = ActiveRecord::Base.connection()
          tm=Time.now
          tm=tm.strftime("%Y-%m-%d %I:%M:%S")
          puts tm




        %>
          <%  if(@i.e_filetype == "swf")
            @sshowSwf = "slideShow"
            #@videoXmlFile = @i.img_url+"/user_content/videos/"+@i.v_filename
            @videoXmlFile = "/slideshow/get_slideshow_moment_list/#{@i.id}"
          end
        %>

          <%@type = @i.e_filetype%>

          <script src="/AC_OETags.js" language="JavaScript"></script>
          <font color="#ff0000"><%= flash[:share_moment123] %></font>
          <script type="text/javascript" src="/javascripts/jquery-1.3.2.min.js"></script>
          <script type="text/javascript">
            jQuery.noConflict();
            var $j = jQuery;
          </script>


          <script type="text/javascript">
            $j(function() {

              //remove js-disabled class
              $j("#viewer").removeClass("js-disabled");

              //create new container for images
              $j("<div>").attr("id", "container").css({ position:"absolute"}).width($j(".wrapper").length * 170).height(170).appendTo("div#viewer");

              //add images to container
              $j(".wrapper").each(function() {
                $j(this).appendTo("div#container");
              });

              //work out duration of anim based on number of images (1 second for each image)
              var duration = $j(".wrapper").length * 2000;

              //store speed for later (distance / time)
              var speed = (parseInt($j("div#container").width()) + parseInt($j("div#viewer").width())) / duration;

              //set direction
              var direction = "rtl";

              //set initial position and class based on direction
              (direction == "rtl") ? $j("div#container").css("left", $j("div#viewer").width()).addClass("rtl") : $j("div#container").css("left", 0 - $j("div#container").width()).addClass("ltr") ;

              //animator function
              var animator = function(el, time, dir) {

                //which direction to scroll
                if(dir == "rtl") {

                  //add direction class
                  el.removeClass("ltr").addClass("rtl");

                  //animate the el
                  el.animate({ left:"-" + el.width() + "px" }, time, "linear", function() {

                    //reset container position
                    $j(this).css({ left:$j("div#imageScroller").width(), right:"" });

                    //restart animation
                    animator($j(this), duration, "rtl");

                    //hide controls if visible
                    ($j("div#controls").length > 0) ? $j("div#controls").slideUp("slow").remove() : null ;

                  });
                } else {

                  //add direction class
                  el.removeClass("rtl").addClass("ltr");

                  //animate the el
                  el.animate({ left:$j("div#viewer").width() + "px" }, time, "linear", function() {

                    //reset container position
                    $j(this).css({ left:0 - $j("div#container").width() });

                    //restart animation
                    animator($j(this), duration, "ltr");

                    //hide controls if visible
                    ($j("div#controls").length > 0) ? $j("div#controls").slideUp("slow").remove() : null ;
                  });
                }
              }

              //start anim
              animator($j("div#container"), duration, direction);

              //pause on mouseover
              $j("a.wrapper").live("mouseover", function() {

                //stop anim
                $j("div#container").stop(true);

                //show controls
                ($j("div#controls").length == 0) ? $j("<div>").attr("id", "controls").appendTo("div#outerContainer").css({ opacity:0.7 }).slideDown("slow") : null ;
                ($j("a#rtl").length == 0) ? $j("<a>").attr({ id:"rtl", href:"javascript:void(0);", title:"rtl" }).appendTo("#controls") : null ;
                ($j("a#ltr").length == 0) ? $j("<a>").attr({ id:"ltr", href:"javascript:void(0);", title:"ltr" }).appendTo("#controls") : null ;

                //variable to hold trigger element
                var title = $j(this).attr("title");

                //add p if doesn't exist, update it if it does
                ($j("p#title").length == 0) ? $j("<p>").attr("id", "title").text(title).appendTo("div#controls") : $j("p#title").text(title) ;
              });

              //restart on mouseout
              $j("a.wrapper").live("mouseout", function(e) {

                //hide controls if not hovering on them
                (e.relatedTarget == null) ? null : (e.relatedTarget.id != "controls") ? $j("div#controls").slideUp("slow").remove() : null ;

                //work out total travel distance
                var totalDistance = parseInt($j("div#container").width()) + parseInt($j("div#viewer").width());

                //work out distance left to travel
                var distanceLeft = ($j("div#container").hasClass("ltr")) ? totalDistance - (parseInt($j("div#container").css("left")) + parseInt($j("div#container").width())) : totalDistance - (parseInt($j("div#viewer").width()) - (parseInt($j("div#container").css("left")))) ;

                //new duration is distance left / speed)
                var newDuration = distanceLeft / speed;

                //restart anim
                animator($j("div#container"), newDuration, $j("div#container").attr("class"));

              });

              //handler for ltr button
              $j("#ltr").live("click", function() {

                //stop anim
                $j("div#container").stop(true);

                //swap class names
                $j("div#container").removeClass("rtl").addClass("ltr");

                //work out total travel distance
                var totalDistance = parseInt($j("div#container").width()) + parseInt($j("div#viewer").width());

                //work out remaining distance
                var distanceLeft = totalDistance - (parseInt($j("div#container").css("left")) + parseInt($j("div#container").width()));

                //new duration is distance left / speed)
                var newDuration = distanceLeft / speed;

                //restart anim
                animator($j("div#container"), newDuration, "ltr");
              });

              //handler for rtl button
              $j("#rtl").live("click", function() {

                //stop anim
                $j("div#container").stop(true);

                //swap class names
                $j("div#container").removeClass("ltr").addClass("rtl");

                //work out total travel distance
                var totalDistance = parseInt($j("div#container").width()) + parseInt($j("div#viewer").width());

                //work out remaining distance
                var distanceLeft = totalDistance - (parseInt($j("div#viewer").width()) - (parseInt($j("div#container").css("left"))));

                //new duration is distance left / speed)
                var newDuration = distanceLeft / speed;

                //restart anim
                animator($j("div#container"), newDuration, "rtl");
              });
            });
          </script>
          <table width="100%" align="center" border="0" cellspacing="0" cellpadding="0">
            <tr>
              <th height="276" colspan="3" align="left" valign="top" scope="col" >

                <table width="95%" align="center" border="0" cellspacing="0" cellpadding="0">
                  <tr>

                    <th height="12" colspan="9" align="center" valign="top" class="btmtxt" scope="col">

                    </th>
                  </tr>
                  <tr>
                    <th align="center" colspan="9" valign="top" scope="col" >
                      <table width="100%" border="0" align="center" cellspacing="0" cellpadding="0">
                        <tr  >
                          <th width="44" height="44" valign="top" align="left"><br>
                            &nbsp;&nbsp;&nbsp;<%= link_to '<img src="/images/arrow1_left_def.png" name="Image23"  border="0" id="Image23" />', { :page => @user_content.previous_page, :id => @i.id, :familyname => params[:familyname],:hmm=>"true" },{ :onMouseOver => "MM_swapImage('Image23','','/images/arrow1_left_over.png',1)"} if @user_content.previous_page %>&nbsp;&nbsp;&nbsp;
                          </th>
                          <th colspan="5" align="center" valign="middle" scope="col" >
                            <%if (@i.e_filetype=="video" || @i.e_filetype=='audio')%>


                              <%if (@i.e_filetype == "video")%>
                                <input type="hidden" id="contentId" value="<%=@i.img_url%>/user_content/videos/<%=@i.v_filename%>.flv">
                                <input type="hidden" id="type" value="video">
                                <input type="hidden" id="proxyurl" value="<%=@i.img_url%>">
                              <% elsif( @i.e_filetype == "audio")%>
                                <input type="hidden" id="contentId" value="<%=@i.img_url%>/user_content/audios/<%=@i.v_filename%>">
                                <input type="hidden" id="type" value="audio">
                                <input type="hidden" id="proxyurl" value="<%=@i.img_url%>">
                              <%end%>
                              <input type="hidden" id="proxyurl" value="<%=@i.img_url%>">
                              <input type="hidden" name="gallery_id" id="gallery_id" value="<%=@gallery_id%>" />
                              <input type="hidden" id="swfName" value="/MediaPlayer">
                              <%
                              if (@userid[0]['themes'] == 'myfamilywebsite' or @userid[0]['themes'] == 'familywebsite_pink_bottom' or @userid[0]['themes'] == 'familywebsite_white_bottom')

                                cwidth=500
                                cheight=401

                              else

                                cwidth=400
                                cheight=301

                              end
                            %>
                              <script src="/AC_OETags.js" language="JavaScript"></script>
                              <script src="DWConfiguration/ActiveContent/IncludeFiles/AC_RunActiveContent.js" type="text/javascript"></script>
                              <script type="text/javascript">
                                var galId = document.getElementById("contentId").value;
                                var flashName = document.getElementById("swfName").value;
                                var proxyurl = document.getElementById("proxyurl").value;
                                var hmmtype = document.getElementById("type").value;
                                var gallery_id = document.getElementById('gallery_id').value;
                                AC_FL_RunContent( 'codebase','http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=7,0,19,0',
                                'width','<%=cwidth%>',
                                'height','<%=cheight%>',
                                'src', flashName,
                                'quality', 'high',
                                'wmode','transparent',
                                'pluginspage','http://www.macromedia.com/go/getflashplayer',
                                'movie',flashName,
                                'allowFullScreen','true',
                                'flashvars', 'hmmtype='+hmmtype+'&content='+galId+'&proxyurl='+proxyurl+'&gallery_id='+gallery_id
                              ); //end AC code
                              </script><noscript><object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=7,0,19,0" width="<%=cwidth%>" height="<%=cheight%>">
                                  <param name="movie" value="/Chapter.swf" />
                                  <param name="quality" value="high" />
                                  <param name="FlashVars"  />
                                  <embed src="/MediaPlayer.swf" quality="high" FlashVars=""  pluginspage="http://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash" width="<%=cwidth%>" height="<%=cheight%>"></embed>
                                </object></noscript><br>
                              <%if (@i.e_filetype == "video")%>

                                <img src="/images/plus_box_new.gif" border="0" onClick="return chgcrpt();" alt="click to get embed source of the video" style="cursor:pointer;">
                                <div id="gen" style="display:none;">

                                  <font color="#666666" face="Arial, Helvetica, sans-serif" size="3">Embeddable Player</font> <input type="text" name="asd" id="asd" value='<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab" width="320" height="266" id="flv1">
                                                                                                                                     <param name="movie" value="http://blog.holdmymemories.com/BlogVideoPlayer.swf" />
                                                                                                                                     <param name="allowfullscreen" value="true" />


                                                                                                                                     <param name="flashvars" value="videopath=<%=@i.img_url%>/user_content/videos/<%=@i.v_filename%>.flv" />
                                                                                                                                     <embed src="http://blog.holdmymemories.com/BlogVideoPlayer.swf" flashvars="videopath=<%=@i.img_url%>/user_content/videos/<%=@i.v_filename%>.flv" allowfullscreen="true" width="320" height="266" name="flv1" type="application/x-shockwave-flash" pluginspage="http://www.adobe.com/go/getflashplayer" />
                                                                                                                                     </object>' onClick="document.getElementById('asd').focus();document.getElementById('asd').select();" size="50"><br />
                                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#999999" size="2" face="Arial, Helvetica, sans-serif">Copy text to place this video in your website or blog</font>
                                </div>
                              <%end%>

                            <%elsif(@i.e_filetype == "image")%>
                              <div id="uploadControl"></div>
                              <script src="/swfobject.js" language="JavaScript"></script>
                              <script type="text/javascript">

                                var flashvars = {imgUrl:'<%=request_content_url%>/user_content/photos/journal_thumb/<%=@i.v_filename%>'};
                                var params = {allowfullscreen:true,bgcolor:'#000000',wmode:'transparent'};
                                var attributes = {};
                                window.onload=swfobject.embedSWF("/SecureImage.swf", "uploadControl", "720", "520", "9.0.0","expressInstall.swf", flashvars, params, attributes);

                              </script>

                              <table  width="100%" align="right">
                                <tr><td align="right" >&nbsp;</td></tr>
                                <tr><td align="right" ></td></tr>
                                <tr><td align="right" >&nbsp;</td></tr>
                              </table>



                              <div id="demo" style="display:none;">
                                <span id="element6">[ Loading Progress Bar ]</span>
                              </div>
                              </div>
                            <%elsif(@i.e_filetype == "swf")%>
                              <input type="hidden" id="swfFile" value="/<%= @sshowSwf%>" >
                              <input type="hidden" id="filename" value="<%= @videoXmlFile%>" >
                              <script language="JavaScript" type="text/javascript">
                                var flash = document.getElementById("swfFile").value;
                                var xmlfilename = document.getElementById("filename").value;
                                AC_FL_RunContent( 'codebase','http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=7,0,19,0',
                                'width','810',
                                'height','450',
                                'src',flash,
                                'quality','high',
                                'pluginspage','http://www.macromedia.com/go/getflashplayer',
                                'movie',flash,
                                'bgcolor','#000000',
                                'allowFullScreen','true',
                                'flashvars', 'xmlfile='+xmlfilename);
                              </script><noscript><object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=7,0,19,0" width="810" height="450"></object></noscript>
                            <%end%>
                          </th>
                          <th width="44" height="44" valign="top" align="right"><br>
                            &nbsp;&nbsp;&nbsp;<%= link_to "<img src='/images/arrow1_right_def.png' name='Image22'  border='0' id='Image22' />",  { :page => @user_content.next_page , :id => @i.id, :familyname => params[:familyname],:hmm=>"true" }, {:onMouseOver =>"MM_swapImage('Image22','','/images/arrow1_right_over.png',1)"} if @user_content.next_page %>&nbsp;&nbsp;&nbsp;
                          </th>
                        </tr>
                      </table>
                    </th>
                  </tr>
                  <tr>
                    <th width="100%" height="0" align="center" valign="bottom"  scope="col" >
                      <h3><br><font color="white" face="arial"><% if @i.v_tagphoto %>&nbsp;&nbsp;&nbsp;&nbsp;<%@imagename=@i.v_tagphoto.split('.')%><%=@imagename[0]%> <%else%> No name <%end%></font></h3>
                      <br>

                    </th>
                  </tr>
                  <tr>
                    <td align="center">
                      <%if @usercontent.e_filetype =='image'%>
                      <table width="100%" align="center">
                        <tr><td align="center">
                                <input type="hidden" name="familyname" id="familyname" value="<%=params[:familyname]%>" />
                                <input type="hidden" name="serverurl" id="serverurl" value="<%=@serverurl%>" />
                                <input type="hidden" name="gallery_id" id="gallery_id" value="<%=@gallery_id%>" />
                                <input type="hidden" name="proxyurls" id="proxyurls" value="<%=@proxyurls%>" />
                                <script type="text/javascript">
                                  var familyname = document.getElementById('familyname').value;
                                  var serverurl = document.getElementById('serverurl').value;
                                  var gallery_id = document.getElementById('gallery_id').value;
                                  var proxyurls = document.getElementById('proxyurls').value;
                                  AC_FL_RunContent( 'codebase','http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=7,0,19,0','width','800','height','90','src','/ImageScrollerComponent','quality','high','pluginspage','http://www.macromedia.com/go/getflashplayer','movie','/ImageScrollerComponent','flashvars', 'gallery_id='+gallery_id+'&familyname='+familyname+'&proxyurl='+serverurl+'&proxyurls='+proxyurls, 'allowFullscreen', 'true','bgcolor','#000000' ); //end AC code
                                </script>

                        </td></tr></table>
                    <%end%>
                    </td>
                  </tr>

                  <tr>


                    <th align="center">
                      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;


                      <%if session[:hmm_user] && logged_in_hmm_user.family_name == params[:familyname]%>




                        <%@journal_check = JournalsPhoto.count(:all, :conditions => "user_content_id='#{@i.id}'")
                        @journalid = JournalsPhoto.find(:all, :conditions => "user_content_id='#{@i.id}'")
                        if @journal_check > 0%>
                          <a href="/manage_content/edit_journal/<%=@journalid[0]['id']%>?familyname=<%=params[:familyname]%>"  class="journal_txt_link"><font color="#fe6809"  style="text-decoration: underline;"><b>Journal this</b></font></a>
                        <%else%>
                          <a href="/manage_content/write_journal/<%=@i.id%>?familyname=<%=params[:familyname]%>" class="journal_txt_link"><font color="#fe6809"  style="text-decoration: underline;"><b>Journal this</b></font></a>
                        <%end%>

                      <%else%>
                        <font color="white" face="arial" ><u><%= link_to_remote("<span class='commentcont'>Add Comment</span>", :update =>"add_comment",
                            :url => {:controller => :my_familywebsite, :action => :new_photo_comment, :id=> @i.id , :familyname => params[:familyname] } ,:layout => false  ) %></u>
                          &nbsp; <%  @photo_comment_count = PhotoComment.count(:all,:conditions => "user_content_id=#{@i.id} and e_approved='approve'")
                          if @photo_comment_count > 0 %>

                            <u><%= link_to_remote("<span class='commentcont'>View Comments</span>", :update =>"add_comment",
                              :url => {:controller => :my_familywebsite, :action => :view_photo_comments, :photo_id => @i.id, :familyname => params[:familyname]  } ,:layout => false  ) %></u>
                          <%end%>
                        </font>
                        <p align="center"><font color="#ff0000"><%=flash[:notice_cc]%></font>
                        </p>

                        <p>
                        <div id="add_comment"></div>
                        </p>



                      <%end%>
                      &nbsp;&nbsp;
                      <%if params[:msg]==1%>
                        <font color="white" face="arial"><%=flash[:notice_gcc]%></font>
                      <%end%>
                    </th>
                  </tr>

                </table>
              </th>
            </tr>

            <tr>
              <th colspan="4" align="center" valign="top" scope="col">
                <%if session[:share]=="check" %>
                <%else%>
                  <% @journals_photo_count = JournalsPhoto.count(:all,:conditions => "user_content_id=#{@i.id}")
                  if (@journals_photo_count >0)%>

                    <table width="100%" align="center"  border="0"  class="border" cellspacing="0" cellpadding="0"  id="table_br">
                      <%  @journals_photo =JournalsPhoto.find(:all,:conditions=>"user_content_id=#{@i.id}",:order=>"id  desc" )
                      for @j in @journals_photo %>
                        <tr>
                          <th align="left" colspan="2" height="32" valign="middle" scope="col" id="table_bar_bg"><span class="btmtxt">&nbsp;&nbsp;Journal</span>
                          <th scope="col" align="right"  id="table_bar_bg">&nbsp;</th>
                        </tr>
                        <tr>
                          <th  align="left" valign="top" scope="col">&nbsp;</th>
                          <th align="left" valign="middle" scope="col"><span class="commenthr"> <%= @j.v_title %> -
                              <% ActiveSupport::CoreExtensions::Time::Conversions::DATE_FORMATS.merge!(
                                :date => "%Y-%m-%d",
                                :presentable_datetime => "%a %b %d, %Y %H:%M",
                                :presentable_date => "%a %b %d, %Y")
                              @created_date=@j.date_added%>
                              <%= @created_date.to_s(:presentable_date) %></span>
                          </th>
                        </tr>
                        <tr>
                          <th height="65" align="left" valign="top" scope="col">&nbsp;</th>
                          <th align="left" valign="top" class="commentcont" scope="col"><%= @j.v_image_comment.gsub("\n", "<br />\n") %></th>
                        </tr>
                      <%end%>
                    </table>
                  <%end%>
                  <table>
                    <tr>
                      <td>
                        <div id=writej></div>
                      </td>
                    </tr>
                  </table>
                </th>
              </tr>
              <tr>
                <td>
                </td>
              </tr>
            </table>

          <%end%>
        <%end%>

      <%else%>
        <table class="border" width="100%" align="center"><tr><td align="center" >
              <font color="#ff0000">	No Moments found.

            </td></tr></table>
      <%end%>
</table>
<script type="text/javascript">
  function chgcrpt()
  {
    if(document.getElementById('gen').style.display=='block')
    {
      document.getElementById('gen').style.display='none';
    }else{
      document.getElementById('gen').style.display='block';
    }
  }
</script>

<script type="text/javascript">
  function page_reload()
  {location.reload(true);}

</script>

